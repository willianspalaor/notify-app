
<style>

	#chat1 .form-outline .form-control~.form-notch div {
pointer-events: none;
border: 1px solid;
border-color: #eee;
box-sizing: border-box;
background: transparent;
}

#chat1 .form-outline .form-control~.form-notch .form-notch-leading {
left: 0;
top: 0;
height: 100%;
border-right: none;
border-radius: .65rem 0 0 .65rem;
}

#chat1 .form-outline .form-control~.form-notch .form-notch-middle {
flex: 0 0 auto;
max-width: calc(100% - 1rem);
height: 100%;
border-right: none;
border-left: none;
}

#chat1 .form-outline .form-control~.form-notch .form-notch-trailing {
flex-grow: 1;
height: 100%;
border-left: none;
border-radius: 0 .65rem .65rem 0;
}

#chat1 .form-outline .form-control:focus~.form-notch .form-notch-leading {
border-top: 0.125rem solid #39c0ed;
border-bottom: 0.125rem solid #39c0ed;
border-left: 0.125rem solid #39c0ed;
}

#chat1 .form-outline .form-control:focus~.form-notch .form-notch-leading,
#chat1 .form-outline .form-control.active~.form-notch .form-notch-leading {
border-right: none;
transition: all 0.2s linear;
}

#chat1 .form-outline .form-control:focus~.form-notch .form-notch-middle {
border-bottom: 0.125rem solid;
border-color: #39c0ed;
}

#chat1 .form-outline .form-control:focus~.form-notch .form-notch-middle,
#chat1 .form-outline .form-control.active~.form-notch .form-notch-middle {
border-top: none;
border-right: none;
border-left: none;
transition: all 0.2s linear;
}

#chat1 .form-outline .form-control:focus~.form-notch .form-notch-trailing {
border-top: 0.125rem solid #39c0ed;
border-bottom: 0.125rem solid #39c0ed;
border-right: 0.125rem solid #39c0ed;
}

#chat1 .form-outline .form-control:focus~.form-notch .form-notch-trailing,
#chat1 .form-outline .form-control.active~.form-notch .form-notch-trailing {
border-left: none;
transition: all 0.2s linear;
}

#chat1 .form-outline .form-control:focus~.form-label {
color: #39c0ed;
}

#chat1 .form-outline .form-control~.form-label {
color: #bfbfbf;
}

.btn-send{
    width: 100%;
    background: #0dcaf0 !important;
    border: none !important;
    margin-top: 10px;
    color: #fff !important;
}


</style>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<script src="https://cdn.socket.io/4.6.0/socket.io.min.js" integrity="sha384-c79GN5VsunZvi+Q/WObgk2in0CbZsHnjEqvFxC5DxHn9lTfNce2WW6h2pH6u/kF+" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ion-sound/3.0.7/js/ion.sound.min.js"></script>

<nav class="navbar navbar-expand-lg navbar-light bg-light">
	<div class="container-fluid">
		<div class="navbar-brand">
			<div style="position: relative; top: 0; left: 0;">
			<img src="img/ava1-bg.webp" alt="Imagem de Perfil" style="width: 50px; height: 50px; border-radius: 50%;">
			</div>
		</div>
	</div>
</nav>
<section style="background-color: #eee;">

	<div class="container py-5">
		<div class="row d-flex justify-content-center">
			<div class="col-md-8 col-lg-6 col-xl-4">

				<div class="card" id="chat1" style="border-radius: 15px;">
						<div class="card-header d-flex justify-content-between align-items-center p-3 bg-info text-white border-bottom-0"
						style="border-top-left-radius: 15px; border-top-right-radius: 15px;">
						<div>
							<i class="fas fa-angle-left"></i>
							<p class="mb-0 fw-bold">Live chat</p>
							<i class="fas fa-times"></i>
						</div>
						<div>
							<img src="img/ava2-bg.webp" alt="avatar_2" style="width: 45px; height: 100%;">
						</div>
					</div>
					<div class="card-body">

						<div id="card-msgs"></div>

						<div class="form-outline">
							<textarea class="form-control" id="text_msg" rows="4"></textarea>
							<button type="button" class="btn btn-send" onclick="sendMessage(this, 2)">Enviar</button>
						</div>

					</div>
				</div>

			</div>
		</div>

	</div>
</section>

<script>

	const id = '1';
    const socket = io('localhost:3002?id=' + id);

    socket.on('connect', () => {
    	console.log('Conectado ao servidor');
    });

    socket.on('newMessage', (data) => {

    	console.log(data);
   		addMessage(data);

       	ion.sound({
            sounds: [
                {name: "chat_alert"}
            ],
            path: "sounds/",
            preload: true,
            volume: 1.0
        });

   		ion.sound.play("chat_alert");
    });

    function sendMessage(el, id_dest){

    	let msg = $("#text_msg").val();
    	let data = {

    		'msg' : msg,
    		'id' : id_dest,
    		'avatar' : 'ava2-bg.webp'
    	}

    	socket.emit('notify', data);

    	addMessage(data, function(){
    		$("#text_msg").val("");
		});;
    }
	
    function addMessage(data, callback){

    	let card = $("#card-msgs");
    	let containerBlock = $("<div>").addClass("d-flex flex-row justify-content-start mb-4");

    	$("<img>").attr({
    		"src" : "img/" + data.avatar
    	}).css({
    		"width" : "45px",
    		"height" : "100%"
    	}).appendTo(containerBlock);

    	let containerMessage = $("<div>")
    	.addClass("p-3 ms-3")
    	.css({
    		"border-radius" : "15px",
    		"background-color" : "rgba(57,192,237,.2)"
    	}).appendTo(containerBlock);

    	$("<p>")
		.addClass("small mb-0")
		.html(data.msg)
		.appendTo(containerMessage);

		$(containerBlock).appendTo(card);

		if(typeof(callback) == 'function'){
			callback();
		}
    }

</script>

